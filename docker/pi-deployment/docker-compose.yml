services:
  music-minion:
    build:
      context: ../..
      dockerfile: Dockerfile
    container_name: music-minion-web
    restart: unless-stopped
    ports:
      - "127.0.0.1:8642:8642"  # Caddy reverse proxy
    volumes:
      - /home/kevin/Music:/home/kevin/Music  # Music library (Syncthing, rw for metadata export)
      - /home/kevin/.local/share/music-minion:/root/.local/share/music-minion  # DB (Syncthing)
    environment:
      - ALLOWED_ORIGINS=https://music.piserver:8443
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8642/health"]
      interval: 30s
      timeout: 10s
      retries: 3
